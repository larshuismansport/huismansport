<!doctype html>
<html lang="nl">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Opdrachten Overzicht | Teamwear & Drukwerk</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
      #searchInput { max-width: 300px; }
    </style>
    <script>
      function confirmDeletion() {
        return confirm("Weet u zeker dat u deze opdracht wilt verwijderen? Dit kan niet ongedaan gemaakt worden.");
      }
    </script>
  </head>
  <body>
    <!-- Navigatiebalk -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
      <div class="container">
        <a class="navbar-brand" href="{{ url_for('index') }}">Teamwear & Drukwerk</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link {% if request.endpoint == 'index' %}active{% endif %}" href="{{ url_for('index') }}">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link {% if request.endpoint == 'add_customer' %}active{% endif %}" href="{{ url_for('add_customer') }}">Nieuwe Klant</a>
            </li>
            <li class="nav-item">
              <a class="nav-link {% if request.endpoint == 'list_customers' %}active{% endif %}" href="{{ url_for('list_customers') }}">Klantenlijst</a>
            </li>
            <li class="nav-item">
              <a class="nav-link {% if request.endpoint == 'add_assignment' %}active{% endif %}" href="{{ url_for('add_assignment') }}">Nieuwe Opdracht</a>
            </li>
            <li class="nav-item">
              <a class="nav-link {% if request.endpoint == 'list_assignments' %}active{% endif %}" href="{{ url_for('list_assignments') }}">Opdrachten</a>
            </li>
            <li class="nav-item">
              <a class="nav-link {% if request.endpoint == 'list_billing_infos' %}active{% endif %}" href="{{ url_for('list_billing_infos') }}">Factuurgegevens</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>      

    <!-- Hoofdinhoud -->
    <div class="container mt-5">
      <h1>Opdrachten Overzicht</h1>
      
      <!-- Zoekfunctie -->
      <div class="mb-3">
        <input type="text" id="searchInput" class="form-control" placeholder="Zoek opdracht...">
      </div>
      
      <!-- (Eventueel) Filter op status -->
      <div class="mb-3">
        <a href="{{ url_for('list_assignments') }}" class="btn btn-outline-primary">Alle</a>
        <a href="{{ url_for('list_assignments', status='Nieuw') }}" class="btn btn-outline-primary">Nieuw</a>
        <a href="{{ url_for('list_assignments', status='In behandeling') }}" class="btn btn-outline-primary">In behandeling</a>
        <a href="{{ url_for('list_assignments', status='Afgerond') }}" class="btn btn-outline-primary">Afgerond</a>
        <a href="{{ url_for('list_assignments', status='Wachtend op akkoord') }}" class="btn btn-outline-primary">Wachtend op akkoord</a>
      </div>
      
      <table class="table table-striped" id="assignmentsTable">
        <thead class="table-primary">
          <tr>
            <th>Opdracht Titel</th>
            <th>Klant</th>
            <th>E-mail</th>
            <th>Vereniging</th>
            <th>Factuur Naam</th>
            <th>Status</th>
            <th>Bestand</th>
            <th>Acties</th>
          </tr>
        </thead>
        <tbody>
          {% for assignment in assignments %}
          <tr>
            <!-- 1) Opdracht Titel -->
            <td>{{ assignment.title }}</td>
            
            <!-- 2) Klantnaam -->
            <td>
              {% if assignment.customer %}
                {{ assignment.customer.name }}
              {% else %}
                Geen klant gekoppeld
              {% endif %}
            </td>
            
            <!-- 3) E-mail van klant -->
            <td>
              {% if assignment.customer %}
                {{ assignment.customer.email }}
              {% else %}
                -
              {% endif %}
            </td>
            
            <!-- 4) Vereniging (zit in customer.vereniging) -->
            <td>
              {% if assignment.customer and assignment.customer.vereniging %}
                {{ assignment.customer.vereniging }}
              {% else %}
                -
              {% endif %}
            </td>
            
            <!-- 5) Factuur Naam (zit in assignment.customer.billing_info) -->
            <td>
              {% if assignment.customer and assignment.customer.billing_info %}
                {{ assignment.customer.billing_info.name }}
              {% else %}
                -
              {% endif %}
            </td>
            
            <!-- 6) Status (assignment.status) -->
            <td>{{ assignment.status }}</td>
            
            <!-- 7) Bestand / voorbeeld (assignment.file) -->
            <td>
              {% if assignment.file %}
                <img src="{{ url_for('static', filename='uploads/' ~ assignment.file) }}" 
                     alt="Voorbeeld" style="max-width: 100px;">
              {% else %}
                Geen
              {% endif %}
            </td>
            
            <!-- 8) Acties -->
            <td>
              <a href="{{ url_for('edit_assignment', id=assignment.id) }}" class="btn btn-sm btn-warning">Bewerk</a>
              <form action="{{ url_for('delete_assignment', id=assignment.id) }}" 
                    method="post" style="display:inline;" onsubmit="return confirmDeletion();">
                <button type="submit" class="btn btn-sm btn-danger">Verwijder</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      
      <a href="{{ url_for('add_assignment') }}" class="btn btn-primary">Voeg Nieuwe Opdracht Toe</a>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      document.getElementById('searchInput').addEventListener('keyup', function () {
        var searchValue = this.value.toLowerCase();
        var rows = document.querySelectorAll('#assignmentsTable tbody tr');
        rows.forEach(function(row) {
          var cellText = row.textContent.toLowerCase();
          row.style.display = cellText.indexOf(searchValue) > -1 ? '' : 'none';
        });
      });
    </script>
  </body>
</html>
